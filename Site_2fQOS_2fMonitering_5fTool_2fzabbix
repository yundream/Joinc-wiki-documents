#title 공개 시스템 모니터링 툴 zabbix

[[TableOfContents]]
== Zabbix ==
오픈마루에서는 zenoss를 사용해서 서비스를 모니터링했다. 그러다가 zabbix에 관심을 가지게 됐다. 이유는 '''지금 회사에서 사용하고 있기 때문'''이다. 익숙한 zenoss를 두고 zabbix를 사용하려고 하니 귀찮음으 폭풍처럼 몰려오지만 어쩌겠는가. 

사실 zabbix가 처음은 아니긴 하다. 2006년 쯤인가 오픈마루에서 서비스들이 하나 둘 런칭될 때, 인프라와 서비스들을 모니터링해야 할 필요가 생겼고 이때 zenoss와 zabbix 중 어느걸 선택할지를 고민을 했었다. 결국 다음의 이유로 zenoss를 선택했다.    
  * Zenoss는 모니터링 소프트웨어가 아닌 자원관리 소프트웨어를 표방했다. IT의 자원을 체계적으로 관리하는게 주요 목적이고, 모니터링은 목적을 효과적으로 달성하기 위한 주요 컴포넌트들 중 하나였다. 반면 zabbix는 모니터링을 전문으로 하는 소프트웨어였다. 나는 장기적으로 전체 IT 자원을 효율적으로 관리하기 위한 시스템을 구축하는게 목적이었기 때문에 zenoss에 더 마음이 갔다. 디바이스 등록에서 부터, 모니터링, 이벤트 발생과 관리 등등을 아우르는 구조도 마음에 들었다. 
  * Zenoss를 이용해서 컨설팅을 하고 있었는데, 이를 위해서 완성도를 높일 필요가 있었던듯 싶다. 이때 이미 zenoss는 기업에서 써도 될만큼의 사용 편의성과 UI를 가지고 있었다.  
  * 당시 모기업도 zenoss를 사용하고 있었다. 경험을 가진 조직으로 부터 정보를 공유할 수 있다는게 큰 장점이었다.  
이런 이유로 zabbix는 설치해서 구경하는 정도로 끝내고 zenoss를 기반으로 자원관리 시스템을 구축했다. 모니터링이 아닌 자원관리 시스템이었다. 자원의 입고부터 출고까지의 라이프사이클 관리, 애플리케이션 배포, 모니터링, 이벤트 정책 수립, 이벤트 라이프사이클 관리..  

=== 준비 할 것들 ===
  * 데이터베이스 : zabbix는 postgresql, mysql, sqlite3를 지원한다. 나는 그냥 익숙한 mysql을 사용하기로 했다. 
  * Apache + php5 : zabbix server는 아파치+php5 기반의 프론트엔드를 제공한다. 미리 설치해 둬야 한다.
  * 즉 '''APM''' 환경을 구축하면 된다.
여기에서는 APM환경 구축은 다루지 않는다.
=== Zabbix 설치 ===
Ubuntu 12.04에 설치하기로 했다. 2006년쯤인가 설치할 때는 이것 저것 대여섯개의 소스파일을 컴파일해야 간신히 설치가 가능했는데(zabbix를 쓰지 않은 이유이기도 하다. 당시에도 zenoss는 설치 패키지를 제공했다.) 지금은 패키지관리자를 이용해서 편하게 설치할 수 있다. 

zabbix server 설치
{{{#!plain
# apt-get install zabbix-server-mysql
}}}

zabbix php 프론트엔드 설치. 세상 편하네..
{{{#!plain
# apt-get install zabbix-frontend-php
}}}

zabbix agent도 설치한다.
{{{#!plain
# apt-get install zabbix-agent
}}}

=== 웹서버 설정 ===
zabbix 웹 프론트엔드 문서의 위치는 /usr/share/zabbix다. Apache의 root directory를 /usr/share/zabbix 로 설정한 다음 apache 서버를 제시작 한다. 
{{{#!plain
<VirtualHost *:80>
        ServerAdmin webmaster@localhost

        DocumentRoot /usr/share/zabbix
        <Directory />
                Options FollowSymLinks
                AllowOverride None
        </Directory>
......
}}}

=== 데이터베이스 설정 ===
mysql을 기준으로 설명한다. zabbix 데이터베이스를 만든다음 schema와 images, data를 입력해야 한다. 데이터베이스 생성 스크립트는 /usr/share/zabbix-server-mysql 디렉토리 밑에 있다.

{{{#!plain
# mysql -u root -p < schema.sql
# mysql -u root -p < images.sql 
# mysql -u root -p < data.sql 
}}}

=== 초기 설정 ===
웹 서버를 재시작하고 서버에 접근하면, 초기 설정 화면이 뜬다. 2. Check of pre-requissites에서 php측 설정이 제대로 돼 있는지를 검사한다. 요구사항(Required)에 맞도록 php.ini 파일을 수정하자.

https://lh5.googleusercontent.com/-DfAiUlInkHI/UWro2j2QvDI/AAAAAAAAC9s/hKCqduvJ11k/s640/zabbix7.jpg

다음 데이터베이스 설정부분이다.

https://lh5.googleusercontent.com/-hXqTR6tslOA/UWro2q90NcI/AAAAAAAAC9w/XQOE8vWybUk/s640/zabbix8.jpg

이걸로 끝
=== 로그인 ===
이제 웹 서버에 접근하면 로그인 페이지가 뜬다. 기본 계정은 admin/zabbix다. 로그인하면 대쉬보드가 뜬다.

https://lh4.googleusercontent.com/-kelSCL6n7Jw/UWmNSKpPpeI/AAAAAAAAC7M/rt5H_jQ3vso/s616/zabbix2.png


=== Brute froce attack 방지 정책 ===
Brute force 공격을 막기 위해서 연속해서 5번 로그인에 실패하면, 30초동안 로그인이 금지된다. 

=== 유저관리 ===
Zabbix가 설치되고 나면, "Admin" 유저와 "guest"유저 단지 2개의 유저만있다. Admin 유저는 사이트에 대한 모든 권한을 가지는 슈퍼유저고, guest 유저는 읽기 권한만을 가진 유저다. 

"Administration" > "User" 에서 "Create user" 명령으로 새로운 유저를 만들 수 있다. 아래 예제에서 "yundream"이라는 이름을 가지는 유저를 만들었다. 이 유저의 타입은 Zabbix User로 Network administrators의 그룹에 속한다. 유저는 기본적으로 어떤 media(notification 방법) 도 가지지 않는다. Media를 클릭해서 어떤 정보를 통지(notification) 할지를 정할 수 있다. 

https://lh3.googleusercontent.com/-BKuDsNEXn2M/UWmUAg4PszI/AAAAAAAAC80/yvo9iuGwVfU/s640/zabbix4.jpg

Media를 클릭하면 팝업창이 뜨는데, 여기에서 통지방법과 받을 사람, 통지할 이벤트의 레벨을 정의할 수 있다.   

https://lh5.googleusercontent.com/-CEd6jIU4sJI/UWmUAUC-LyI/AAAAAAAAC7o/Yvf_mpGV3uw/s800/zabbix5.png

=== Email 설정 ===
"Menu" > "Administration" > "Media Type"에서 이메일설정을 할 수 있다. Media type에는 "Email, Jabber, SMS, Script"의 미리 정해진 타입이 있다. 

== 하위 문서들 ==
[[subindex]]
