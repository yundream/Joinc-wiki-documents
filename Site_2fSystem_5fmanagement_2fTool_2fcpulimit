#title cpulimit를 이용한 프로세스 별 CPU 사용 가능량 조절

=== Mysql 데몬 문제 ===
joinc는 mysql(:12)을 이용해서 데이터 베이스를 관리한다. 그런데, 주기적으로 CPU 점유율을 100%가량 가까이 먹어버리는 경우가 발생한다. 추적해 본 결과 검색엔진(:12)기타 몇몇 로봇들이 사이트를 크롤링 하면서 이런 문제가 발생하는 것같았다. 명확하지는 않다. 몇몇 로봇은 아예 막아버리기도 했으나 근본적인 해결책은 되지 않았다.

그래서 mysql 데몬의 CPU 점유율을 제한해 버리기로 했다. 정상적인 요청이라면 CPU 자원을 10% 정도만 할당해도, 서비스를 하는데 문제 없을 것이라 생각되기 때문이다. 

=== cpulimit ===
관련 프로그램이 있는지 구글(:12)신탁을 받기로 했다. 신탁의 결과물은 cpulimit 였다. 신탁을 받들어서 다운받았는데, 소스코드 하나와 make파일 하나만 포함한 아주 간단한 프로그램이였다. 간단해서 코드를 살펴봤다. proc(:12) 파일 시스템을 뒤져서 지정된 프로세스(:12)의 PID를 얻어오고 SIGSTOP와 SIGCONT 시그널(:12)을 이용해서 짧은 휴식을 주는 식으로 사용율을 조절했다. 괜찮은 방법 같았다. 

사용 방법은 간단하다. 프로세스 이름이 mysqld인 프로세스의 CPU 점유율을 30%로 제한했다.
{{{#!plain
# cpulimit --exe mysqld --limit 30
}}}

PID단위로 제한할 수도 있다.
{{{#!plain
# cpulimit --pid 1111 --limit 30
}}}

=== 사용 후기 ===
cpulimit로 mysqld의 cpu 점유율을 제한한 후, 컴퓨팅 환경이 좋아진 것을 체감할 수 있을 정도로 효과가 있었다. 혹시 비슷한 문제로 고민하고 있다면 cpulimit를 추천한다. 간혹 단일 http 프로세스가 100%가 되는 경우도 있는데, 이것도 제한해볼까 생각중이다. 정상적이라면 50%를 넘어서는 안될 것이라고 생각되기 때문이다.

적당한 CPU 제한치는 프로세스 사용율 통계자료를 분석해서 설정해야 할 것으로 생각된다.

[[Category(15)]]
