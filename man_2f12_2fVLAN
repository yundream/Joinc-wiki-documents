#title VLAN - Virtual LAN

[[TableOfContents]]
== LAN ==
LAN에 대한 여러가지 정의가 있을 수 있겠는데요. '''브로드캐스팅 되는 주소영역'''이라고 하는게 가장 이해하기 쉬운 정의인 것 같습니다. 

{{{#!html
<img src="https://docs.google.com/drawings/pub?id=1mOjRQbKyD6C7V5UadD3Fzg-nWzu7Yzj7hb-lrO-LM94&amp;w=490&amp;h=492">
}}}

어떤 장치 없이 서로 통신 가능한 네트워크 영역에 묶여있는 셈이죠. 일반적으로 물리적으로 가까운 사무실, 연구실의 노드를 하나로 묶어서 통신하기 위한 목적으로 사용합니다. 

그림은 두 개의 LAN 1과 LAN 2의 구성을 보여주고 있습니다. 각 LAN은 L2 Switch로 묶일 거구요. L2 Switch라면 그냥 허브 정도로 생각하시면 될것 같습니다. LAN 1과 LAN 2는 물리적으로 분리돼 있기 때문에 통신을 위해서는 L3 스위치를 거쳐야 할 거구요.  

LAN에 대한 설명은 이정도로 하겠습니다.

== VLAN ==
위 그림을 다시 한번 보도록 하죠. 다음과 같이 가정을 해보겠습니다.
  * 인터넷 서비스를 개발하는 회사입니다. 
  * LAN 1 : 개발팀에서 인터넷에 연결하기 위해서 사용하는 네트워크 입니다.   
  * LAN 2 : 개발한 서비스를 테스트하기 위해서 사용하는 네트워크 입니다.

분리하는 이유는 대표적인 이유는 다음과 같습니다.
  * 보안 : 개발팀이 사용하는 네트워크는 보안 수준이 낮아도 상관없겠지만, 테스트 네트워크는 보안 수준이 높아야 겠죠.  
  * 트래픽 분리 : 테스트 네트워크에 대량의 트래픽이 발생한다고 가정해봅시다. 만약 같은 LAN에 묶여있다면, 개발자들이 네트워크를 사용하는데 애로사항이 꽃필 겁니다. 반대로 개발자가 대량의 트래픽을 만들어서 테스트 서버들에 영향을 끼칠 수 있을 겁니다. 그러니 분리하는게 깔끔하죠.   

이때, 새로운 서비스 개발을 위해서 협력 개발 업체의 개발자가 합류했습니다. 그들을 위해서 새로운 네트워크를 구성하기로 했습니다. Switch를 하나 더 두는 방법이 있긴 합니다만 Switch 구입, 회선 준비 등 여간 귀찮은게 아닙니다. 그래도 이 정도라면 물리적인 장비를 투입해서 구성할만 합니다만, 규모가 커지면 쉬운일이 아니죠. 

VLAN을 사용하면, 물리적인 한계를 벗어나서 가상의 LAN을 구성할 수 있습니다.

{{{#!html
<img src="https://docs.google.com/drawings/pub?id=1NARQ-1OEhX0fWA_TUVnrbtiD_o14O1sNEa0XdPI_1Yo&amp;w=490&amp;h=492">
}}}

그림에서 처럼 물리적인 구성을 손대지 않고 논리적인 LAN을 만들 수 있습니다. 이를테면 LAN 3을 위한 가상의 스위치를 만들 수 있다 그렇게 보시면 되겠습니다.  

== Protocol ==
VLAN을 위해서 사용하는 프로토콜은 '''IEEE 802.1Q'''입니다. IEEE 802.1Q는 '''VLAN tagging'''라고 부르기도 합니다. 네트워크 프레임에 '''tagging'''을 하기 때문이죠.  

{{{#!html
<img src="https://docs.google.com/drawings/pub?id=1sEWPcsIgJUtb3r3LbtyGDcYKYmzRcXnpwAh2j8CB9Sc&amp;w=727&amp;h=100">
}}}

패킷을 보면 802.1Q를 위한 필드를 볼 수 있습니다. 헤더의 크기는 32bit 인데요. 이중 12bit가 VLAN 태깅을 위해 할당 돼 있습니다. 12비트면 4096이군요. 약 4000개의 LAN을 만들 수 있겠군요. 

4000개의 LAN이면 상당히 큰 숫자 입니다. 4000개의 LAN을 구성해야 하는 경우가 흔치 않을테니까요. 하지만 최근에는 이런 수요가 있습니다. 요즘 통신사를 중심으로 Cloud(:12) Center를 구축을 하는데요. VLAN을 이용해서 LAN을 나눕니다. 하드웨어의 배치없이 유연하게 LAN을 변경할 수 있기 때문입니다. 이 경우 4000개를 넘길 수가 있습니다.

그래서 Double Tagging을 사용하기도 합니다. 802.1Q 프레임을 두개를 사용합니다.

{{{#!html
<img src="https://docs.google.com/drawings/pub?id=1XIj2j4CPgBlHIMOP2L9OyA0zXCWwc189cPGC3O9DUkQ&amp;w=727&amp;h=100">
}}}

구성하는 방법은 간단합니다. VLAN을 묶기를 원하는 HOST를 같은 이름으로 태깅을 합니다. HOST라기 보다는 MAC ADDRESS라고 하는게 명확하겠군요.   

{{{#!html
<img src="https://docs.google.com/drawings/pub?id=19YRn7S_TuJT3lvTtsKzqEv7o9sx1_YURzRJxuc2JwYc&amp;w=490&amp;h=492">
}}}

4개의 호스트를 12로 태깅을 했습니다. 물론 태깅을 하려면 스위치가 VLAN을 지원해야 겠죠. 이제 이 4개의 호스트는 하나의 랜처럼 작동합니다. 

이상은 제가 VLAN에 대해서 문서로 공부하면서 알아낸 정보입니다. 실제 네트워크 환경을 갖춰서 테스트 해봐야 겠습니다.  

== 관련 글 ==
  1. [wiki:Site/System_management/GNS3Layer2_03 GNS3를 이용한 VLAN 테스트]
== history ==
  1. 작성일 : 2011년 8월 27일

[[Category(15)]]
