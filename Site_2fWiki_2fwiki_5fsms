#title wiki와 zenoss를 이용한 시스템관제 툴

=== 시스템 관제 ===
인터넷 서비스를 위해서 수백~수천대의 컴퓨터 시스템과 네트워크 장비를 관리한다면, 시스템 관제가 필수 적일 것이다. 일반적으로는 snmp(:12)와 MRTG(:12)를 이용해서, 관제를 하지만 이것으로는 기본적인 정보만을 얻을 수 있다. 나는 MRTG와 SNMP를 뛰어넘는 IT자원관리의 틀에서, 시스템/네트워크 환경의 정보를 수집하고, 분석하고, 이벤트를 발생시키고 Report까지 제공하는 시스템을 만들기를 원했다. 이 Report에는 과거/현재에 발생한 사건들에 대한 정보와 미래에 일어날 사건을 어느정도 예측할 수 있는데 도움을 주는 통계정보까지를 포함되어야 한다.

=== 구조 ===
기본 구성은[wiki:Site/QOS/Monitering_Tool/History_Management wiki와 zenoss를 이용한 시스템 이벤트 이력관리 시스템 구축]문서를 참고하기 바란다.

zenoss는 Event기반의 매우 훌륭한 관제툴이지만, 통합 모니터링 환경을 제공하지는 않는다. 그래서 zenoss와 wiki기반의 통합관제툴을 만들기로 했다. zenoss는 시스템의 정보를 RRD(:12)형태로 저장을 하기 때문에, wiki에서 RRD 파일을 제어하는 모듈과 인터페이스 관련 모듈을 만든다면 어렵지 않게 통합 모니터링 환경을 만들 수 있으리라 생각했기 때문이다.  

{{{#!plain
    +---------+    +------------------+
    | Zenoss  |    | WIKI             |
    |         |    |                  |
    |         |    |                  |
 +--|         |    |                  |
 |  +---------+    |                  |
 |  +---------+    |  +------------+  |
 +->| RRD     |----|->| RRD macro  |  |
    +---------+    |  +------------+  |
                   |                  |
                   +------------------+
}}}
  1. Zenoss가 수집한 시스템 정보는 Device/성능별 RRD(:12)파일로 저장이 된다. 즉 Device의 이름만 알면, 해당 시스템의 성능을 저장한 RRD 파일을 찾을 수 있고, RRD 파일로 부터 그래프를 그려낼 수 있다.
    {{{#!plain
perf -+-- Device1 ---+-- CPU.rrd
      |              |
      |              +-- Disk.rrd
      |              |
      |              +-- Interface.rrd 
      +-- Device2 ---+-- CPU.rrd
                     |
                     +-- Disk.rrd
                     |
                     +-- Interface.rrd 
}}}
  1. RRD wiki macro는 시스템 이름의 디렉토리 밑에 있는 rrd 파일을 모두 읽어서, 이것을 그래프로 변경시켜준다.
  1. perf 디렉토리를 scan 하면, rrd 정보를 포함하고 있는 모든 시스템의 이름을 얻어올 수 있다. 이것을 이용해서 관리중인 장비정보를 보여주는 인터페이스를 제작한다. scandir()류의 함수를 이용하면 어렵지 않게 제작할 수 있다.
  1. 시스템 목록에서, 보고 싶은 시스템을 클릭하면, 시스템의 상세정보를 보여주는 화면으로 넘어간다.
  1. RRD 파일과 SNMP를 제어할 수 있는 wiki macro를 만들어서 시스템의 상세정보를 얻어올 수 있다. SNMP와 RRD에 대해서 이해하고 있다면, 수백라인 수준에서 간단하게 제작할 수 있다.

=== 운용 모습 ===
다음은 실제 개발해서 운용하고 있는 화면들이다. 일부분만 보여주고 있다.

attachment:wiki_sms1.png

관리중인 전체 장비목록과 기본 정보들을 보여주고 있다. snmp와 rrd 정보를 이용해서 만들었다.

attachment:wiki_sms2.png

장비를 클릭했을 때 보여지는 상세화면이다. 시스템 가용율, CPU정보, 인터페이스, Memory, ICMP, Mysql 정보가 보인다.

attachment:wiki_sms3.png

위 그림에서 이어지는 화면으로 CPU, Interface, Memory, 파일시스템의 월간 통계정보를 보여주고 있다. 짤려서 보이지 않고 있지만, 아래에는 장비에서 발생한 이벤트들의 이력 정보가 있다. 

=== 평가 ===
wiki의 활용도는 무궁무진하다. 위키를 사용하는 많은 사용자들이 단지 문서를 관리하기 위한 목적으로 사용하고 있는데, wiki의 특징을 이용한다면 기업자원을 관리하기 위한 용도로까지 얼마든지 확장해서 사용할 수 있도록 되어 있다. 실제 이 기능은 내가 만들고 있는 ITMS중 일부분으로 장비관리, [wiki:Site/Wiki/service_support 업무지원시스템], 사용자관리, 분산 성능측정 시스템, 자동 배포 시스템을 포함한 포괄적인 시스템으로 만들어가고 있는 중이다. 분산성능 측정 시스템이 구현이 된다면, 이것을 확장해서 Master->Slave의 JOB 배포 구조를 가지는 '''분산 정보 처리'''시스템까지를 개발할 계획이다. 

이런 것까지 가능할까? 라고 생각할 수 있겠지만. 가능하다. 필요한건 idea이다. 나머지는 위키가 알아서 해결해준다.

[[ShowComment(399)]]
